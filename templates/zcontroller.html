<div id="zcontroller_panel" class="modal">
    <div class="modal-content">

		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title">Zynthian Controllers</h4>
		</div>

		<div class="modal-body">
        	<table class="table">
			<thead>
			<tr>
				<th class="col-md-1">Visible</th>
				<th class="col-md-3">Name</th>
				<th class="col-md-8">Value</th>
			</tr>
			</thead>
			<tbody>
{% for controllername in config['ZCONTROLLERS'] %}
				<tr>
					<td><input type="checkbox" name="ZYNTHIAN_CONTROLLER_VISIBLE_{{ controllername}}" value="{{ controllername }}" /></td>
					<td>{{ controllername }}</td>
					<td>
{% if config['ZCONTROLLERS'][controllername].is_integer %}
						<input type="text" id="ZYNTHIAN_CONTROLLER_VALUE_{{ escape(controllername) }}" name="ZYNTHIAN_CONTROLLER_VALUE_{{ escape(controllername) }}" data-provide="slider"
				data-slider-min="0"
				data-slider-max="100"
				data-slider-step="1"
				data-slider-value="{{ config['ZCONTROLLERS'][controllername].get_value() }}"
				data-slider-tooltip="show"
						/>
{% end %}
					</td>
				</tr>
{% end %}
			</tbody>
		</table>
		</div>
	<div class="modal-footer">
		<button id="zynthian_controllers_save" class="btn btn-block btn-success" data-dismiss="modal" type="button"><span aria-hidden="true">OK</span></button>
		
	</div>
    </div>
</div>

<script>
	$(document).ready(function() {
	$('#display_zcontroller_panel').click(function(){
		$('#zcontroller_panel').show(500)
	});


	$('#zcontroller_panel .close').click(function(){
		$('#zcontroller_panel').hide(500)
	});

	window.onclick = function(event) {
		if (event.target == document.getElementById('zcontroller_panel')) {
			$('#zcontroller_panel').hide(500);
		}
	}

	document.getElementById('zynthian_controllers_save').onclick = function(event) {
		if (refreshZynthianControllers()){
			$('#zcontroller_panel').hide(500);
		} else {
			alert('Saving the controllers failed!');
		}
	}
});

function refreshZynthianControllers(){
	zynthianControllersTextarea = document.getElementById('ZYNTHIAN_CONTROLLERS') ;

	zynthianControllersTextarea.value = '';
	visibleControllers = $("input[name^=ZYNTHIAN_CONTROLLER_VISIBLE_]:checkbox:checked");
	for (var i = 0; i < visibleControllers.length; i++){
		zynthianControllersTextarea.value += visibleControllers[i].value + ',';
	}
	if (zynthianControllersTextarea.value.slice(-1)==',') zynthianControllersTextarea.value=zynthianControllersTextarea.value.slice(0,-1)

	return true;	
}
</script>
